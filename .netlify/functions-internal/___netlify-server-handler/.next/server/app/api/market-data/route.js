(()=>{var t={};t.id=139,t.ids=[139],t.modules={3295:t=>{"use strict";t.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74690:(t,a,e)=>{"use strict";e.r(a),e.d(a,{patchFetch:()=>y,routeModule:()=>m,serverHooks:()=>k,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>p});var r={};e.r(r),e.d(r,{GET:()=>c});var i=e(96559),d=e(48088),s=e(37719),o=e(32190);let n=[{date:"2024-01-15",price:2200,commodity:"Wheat",state:"Jharkhand",district:"Ranchi",market:"Ranchi Main Market"},{date:"2024-02-10",price:2250,commodity:"Wheat",state:"Jharkhand",district:"Ranchi",market:"Ranchi Main Market"},{date:"2024-03-20",price:2300,commodity:"Wheat",state:"Jharkhand",district:"Ranchi",market:"Daily Market"},{date:"2024-04-05",price:2350,commodity:"Wheat",state:"Jharkhand",district:"Hazaribagh",market:"Hazaribagh Mandi"},{date:"2024-05-15",price:2320,commodity:"Wheat",state:"Jharkhand",district:"Ranchi",market:"Ranchi Main Market"},{date:"2024-06-10",price:2380,commodity:"Wheat",state:"Jharkhand",district:"Hazaribagh",market:"Hazaribagh Mandi"},{date:"2024-04-20",price:2150,commodity:"Wheat",state:"Punjab",district:"Amritsar",market:"Amritsar Mandi"},{date:"2024-05-05",price:2175,commodity:"Wheat",state:"Punjab",district:"Ludhiana",market:"Ludhiana Mandi"},{date:"2024-05-25",price:2200,commodity:"Wheat",state:"Punjab",district:"Amritsar",market:"Amritsar Mandi"},{date:"2024-06-15",price:2225,commodity:"Wheat",state:"Punjab",district:"Ludhiana",market:"Ludhiana Mandi"},{date:"2024-01-18",price:1850,commodity:"Paddy",state:"Jharkhand",district:"Ranchi",market:"Ranchi Main Market"},{date:"2024-02-12",price:1870,commodity:"Paddy",state:"Jharkhand",district:"Hazaribagh",market:"Hazaribagh Mandi"},{date:"2024-06-01",price:1900,commodity:"Paddy",state:"Jharkhand",district:"Ranchi",market:"Ranchi Main Market"},{date:"2024-01-20",price:1800,commodity:"Paddy",state:"Bihar",district:"Patna",market:"Patna Mandi"},{date:"2024-02-15",price:1820,commodity:"Paddy",state:"Bihar",district:"Patna",market:"Patna Mandi"},{date:"2024-03-25",price:1850,commodity:"Paddy",state:"Bihar",district:"Gaya",market:"Gaya Mandi"},{date:"2024-04-10",price:1880,commodity:"Paddy",state:"Bihar",district:"Muzaffarpur",market:"Muzaffarpur Mandi"},{date:"2024-05-20",price:1860,commodity:"Paddy",state:"Bihar",district:"Patna",market:"Patna Mandi"},{date:"2024-05-01",price:1950,commodity:"Paddy",state:"West Bengal",district:"Purba Bardhaman",market:"Bardhaman Market"},{date:"2024-05-15",price:1980,commodity:"Paddy",state:"West Bengal",district:"Purba Bardhaman",market:"Bardhaman Market"},{date:"2024-06-01",price:2e3,commodity:"Paddy",state:"West Bengal",district:"Hooghly",market:"Hooghly Market"},{date:"2024-06-15",price:2020,commodity:"Paddy",state:"West Bengal",district:"Hooghly",market:"Hooghly Market"},{date:"2024-01-25",price:1600,commodity:"Maize",state:"Uttar Pradesh",district:"Lucknow",market:"Lucknow Mandi"},{date:"2024-02-20",price:1625,commodity:"Maize",state:"Uttar Pradesh",district:"Lucknow",market:"Lucknow Mandi"},{date:"2024-03-15",price:1650,commodity:"Maize",state:"Uttar Pradesh",district:"Kanpur",market:"Kanpur Mandi"},{date:"2024-04-12",price:1675,commodity:"Maize",state:"Uttar Pradesh",district:"Varanasi",market:"Varanasi Mandi"},{date:"2024-01-10",price:5500,commodity:"Mustard",state:"Jharkhand",district:"Jamshedpur",market:"Sakchi Market"},{date:"2024-02-05",price:5550,commodity:"Mustard",state:"Jharkhand",district:"Jamshedpur",market:"Sakchi Market"},{date:"2024-03-10",price:5600,commodity:"Mustard",state:"Jharkhand",district:"Ranchi",market:"Daily Market"},{date:"2024-04-01",price:5650,commodity:"Mustard",state:"Jharkhand",district:"Hazaribagh",market:"Hazaribagh Mandi"},{date:"2024-01-10",price:5800,commodity:"Mustard",state:"Rajasthan",district:"Jaipur",market:"Jaipur Mandi"},{date:"2024-02-05",price:5850,commodity:"Mustard",state:"Rajasthan",district:"Jaipur",market:"Jaipur Mandi"},{date:"2024-03-10",price:5900,commodity:"Mustard",state:"Rajasthan",district:"Alwar",market:"Alwar Mandi"},{date:"2024-04-01",price:5950,commodity:"Mustard",state:"Rajasthan",district:"Alwar",market:"Alwar Mandi"},{date:"2024-05-10",price:5920,commodity:"Mustard",state:"Rajasthan",district:"Jaipur",market:"Jaipur Mandi"},{date:"2024-01-22",price:7e3,commodity:"Cotton",state:"Gujarat",district:"Ahmedabad",market:"Ahmedabad Cotton Exchange"},{date:"2024-02-18",price:7100,commodity:"Cotton",state:"Gujarat",district:"Ahmedabad",market:"Ahmedabad Cotton Exchange"},{date:"2024-03-28",price:7200,commodity:"Cotton",state:"Gujarat",district:"Surat",market:"Surat Textile Market"},{date:"2024-04-15",price:7250,commodity:"Cotton",state:"Gujarat",district:"Surat",market:"Surat Textile Market"},{date:"2024-01-28",price:4500,commodity:"Soyabean",state:"Madhya Pradesh",district:"Indore",market:"Indore Mandi"},{date:"2024-02-25",price:4550,commodity:"Soyabean",state:"Madhya Pradesh",district:"Indore",market:"Indore Mandi"},{date:"2024-03-18",price:4600,commodity:"Soyabean",state:"Madhya Pradesh",district:"Ujjain",market:"Ujjain Mandi"},{date:"2024-04-20",price:4650,commodity:"Soyabean",state:"Madhya Pradesh",district:"Ujjain",market:"Ujjain Mandi"},{date:"2024-05-05",price:1500,commodity:"Onion",state:"Maharashtra",district:"Nashik",market:"Lasalgaon Mandi"},{date:"2024-05-12",price:1550,commodity:"Onion",state:"Maharashtra",district:"Nashik",market:"Lasalgaon Mandi"},{date:"2024-05-19",price:1480,commodity:"Onion",state:"Maharashtra",district:"Pune",market:"Pune Market"},{date:"2024-05-26",price:1520,commodity:"Onion",state:"Maharashtra",district:"Nashik",market:"Lasalgaon Mandi"},{date:"2024-06-02",price:1600,commodity:"Onion",state:"Maharashtra",district:"Pune",market:"Pune Market"},{date:"2024-06-09",price:1650,commodity:"Onion",state:"Maharashtra",district:"Nashik",market:"Lasalgaon Mandi"}];async function c(t){let a=t.nextUrl.searchParams,e=a.get("commodity"),r=a.get("state"),i=a.get("district"),d=a.get("market"),s=a.get("toDate")||new Date().toISOString().split("T")[0],c=new Date;c.setDate(c.getDate()-30);let m=a.get("fromDate")||c.toISOString().split("T")[0],h=[process.env.AGMARKNET_API_KEY,process.env.AGMARKNET_API_KEY_2,process.env.AGMARKNET_API_KEY_3].filter(Boolean),p={commodity:e,state:r,district:i,market:d},k=()=>{let t=function(t,a,e){let r=n,i=t.commodity||t.state||t.district||t.market;return i&&(t.commodity&&(r=r.filter(a=>a.commodity.toLowerCase()===t.commodity?.toLowerCase())),t.state&&(r=r.filter(a=>a.state.toLowerCase()===t.state?.toLowerCase())),t.district&&(r=r.filter(a=>a.district.toLowerCase()===t.district?.toLowerCase())),t.market&&(r=r.filter(a=>a.market.toLowerCase().includes(t.market?.toLowerCase()??"")))),a&&(r=r.filter(t=>new Date(t.date)>=new Date(a))),e&&(r=r.filter(t=>new Date(t.date)<=new Date(e))),0===r.length&&i&&(r=function(t,a,e){let{commodity:r,state:i,district:d,market:s}=t;if(!r||!i||!d)return[];let o=[],n=2e3+3e3*Math.random(),c=10+Math.floor(10*Math.random()),m=e?new Date(e):new Date,h=new Date(a||new Date().setDate(m.getDate()-30));for(let t=0;t<c;t++){let t=new Date(h.getTime()+Math.random()*(m.getTime()-h.getTime())),a=n+(Math.random()-.5)*400;o.push({date:t.toISOString().split("T")[0],price:parseFloat(a.toFixed(2)),commodity:r,state:i,district:d,market:s||`${d} Main Market`})}return o.sort((t,a)=>new Date(t.date).getTime()-new Date(a.date).getTime())}(t,a,e)),r.map(t=>({date:t.date,price:10*t.price,minPrice:.95*t.price*10,maxPrice:1.05*t.price*10,commodity:t.commodity,variety:"N/A",state:t.state,district:t.district,market:t.market}))}(p,m,s);return o.NextResponse.json({data:t})};if(0===h.length||!h[0])return k();for(let t of h){let a=new URLSearchParams({"api-key":t,format:"json",offset:"0",limit:"500"});Object.entries(p).forEach(([t,e])=>{e&&a.append(`filters[${t}]`,e)});let e=new Date(m).toISOString().split("T")[0];a.append("filters[arrival_date]",e);try{console.log(`Trying Agmarknet API key ending in ...${t.slice(-4)}`);let e=await fetch(`https://api.data.gov.in/agmarknet/records?${a.toString()}`),r=await e.text();if(!e.ok||r.trim().startsWith("<")||"Not Found"===r.trim()){console.warn(`Agmarknet API key ending in ...${t.slice(-4)} failed or returned non-JSON response. Trying next key.`);continue}let i=JSON.parse(r).records||[];if(i.length,s&&(i=i.filter(t=>new Date(t.arrival_date)<=new Date(s))),i.length>0){console.log(`Successfully fetched ${i.length} records with key ...${t.slice(-4)}`);let a=i.map(t=>({date:t.arrival_date,price:10*(parseFloat(t.modal_price)||0),minPrice:10*(parseFloat(t.min_price)||0),maxPrice:10*(parseFloat(t.max_price)||0),commodity:t.commodity,variety:t.variety,state:t.state,district:t.district,market:t.market}));return o.NextResponse.json({data:a})}}catch(a){console.error(`Error fetching from Agmarknet with key ...${t.slice(-4)}`,a);continue}}return k()}let m=new i.AppRouteRouteModule({definition:{kind:d.RouteKind.APP_ROUTE,page:"/api/market-data/route",pathname:"/api/market-data",filename:"route",bundlePath:"app/api/market-data/route"},resolvedPagePath:"C:\\Users\\balac\\OneDrive\\Desktop\\Crop Navi\\src\\app\\api\\market-data\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:h,workUnitAsyncStorage:p,serverHooks:k}=m;function y(){return(0,s.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:p})}},78335:()=>{},96487:()=>{}};var a=require("../../../webpack-runtime.js");a.C(t);var e=t=>a(a.s=t),r=a.X(0,[447,580],()=>e(74690));module.exports=r})();